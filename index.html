<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mercy Clinics OAC Suite</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0a7">
<style>
  :root{--bg:#f6f9fc;--card:#fff;--ink:#0b1220;--muted:#6a758f;--brand:#0a7;--ok:#0b915b;--warn:#c27c00;--danger:#b93535;--border:#d8e1ee;}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,'Segoe UI',Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:1120px;margin:0 auto;padding:18px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:6px 0 16px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo img{height:46px}
  h1{font-size:1.35rem;margin:0} .sub{color:var(--muted);font-size:.92rem}
  .tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
  .tab{background:#e9f7f2;color:#075;padding:8px 12px;border-radius:999px;border:1px solid #b7ebdb;cursor:pointer;font-weight:600}
  .tab[aria-selected="true"]{background:var(--brand);color:#fff;border-color:var(--brand)}
  .panel{display:none} .panel.active{display:block}
  .card{background:var(--card);border-radius:16px;border:1px solid var(--border);box-shadow:0 10px 24px rgba(10,20,60,.06);padding:16px;margin-bottom:16px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .rows{display:grid;gap:10px}
  label{display:block;font-weight:700;margin-bottom:6px}
  input[type=number],select,input[type=range],input[type=text]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:1rem}
  input[type=range]{padding:0}
  .muted{color:var(--muted);font-size:.92rem} .out{font:700 1.15rem/1.2 system-ui}
  table{width:100%;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;margin-top:8px}
  th,td{padding:9px 10px;text-align:left;border-bottom:1px solid #eef2f8;font-size:.95rem} th{background:#f6faf8;font-weight:800}
  .badge{font-size:.8rem;padding:2px 8px;border-radius:999px;border:1px solid #ccd}
  .ok{background:#e8f7ee;border-color:#bfe8d0;color:#0b5}
  .borderline{background:#fff4da;border-color:#ffd89e;color:#a86a00}
  .low{background:#fdeaea;border-color:#f2b6b6;color:#b21}
  .note{background:#f0f5ff;border:1px dashed #c9d6ff;border-radius:12px;padding:10px 12px}
  footer{margin-top:18px;color:var(--muted);font-size:.85rem}
  .tagline{font-style:italic;color:#b23;font-weight:700}
  @media print{
    body{background:#fff}
    .tabs, header button, .no-print{display:none!important}
    .card{box-shadow:none;border:1px solid #ddd}
  }
  .install-btn{border:1px solid #0a7;background:#0a7;color:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"><img src="assets/logo-horizontal.png" alt="Mercy Clinics"></div>
      <div>
        <h1>OAC Suite — Oral Aperture Tools</h1>
        <div class="sub">Mercy Clinics — Dr. Richard E. Nnabuko</div>
      </div>
    </div>
    <button id="installBtn" class="install-btn" style="display:none">Install</button>
  </header>

  <nav class="tabs" role="tablist" aria-label="OAC tools">
    <button class="tab" role="tab" aria-selected="true" data-panel="calc">Calculator</button>
    <button class="tab" role="tab" aria-selected="false" data-panel="reverse">Reverse</button>
    <button class="tab" role="tab" aria-selected="false" data-panel="macro">Macrostomia Planner</button>
    <button class="tab" role="tab" aria-selected="false" data-panel="thresholds">Clinical Thresholds</button>
    <button class="tab" role="tab" aria-selected="false" data-panel="about">About</button>
  </nav>

  <section id="panel-calc" class="panel active">
    <div class="card grid">
      <div>
        <label for="calcIID">Inter-incisor distance (IID, mm)</label>
        <input id="calcIID" type="number" value="35" min="5" max="80" step="0.1">
        <label for="calcICD" style="margin-top:10px">Inter-commissural distance (ICD, mm)</label>
        <input id="calcICD" type="number" value="45" min="5" max="120" step="0.1">
      </div>
      <div class="rows">
        <div><span class="muted">OAC (Quick) ≈ (π/2)(IID+ICD)</span><div id="calcOACq" class="out">—</div></div>
        <div><span class="muted">OAC (Precise, Ramanujan I)</span><div id="calcOACp" class="out">—</div></div>
        <div><span class="muted">Δ (Quick − Precise)</span><div id="calcDelta" class="out">—</div></div>
      </div>
    </div>
    <div class="card"><div class="note">Use <b>active</b> measurements. Quick ≈ is typically within 1–2% of the precise ellipse.</div></div>
  </section>

  <section id="panel-reverse" class="panel">
    <div class="card">
      <div class="grid">
        <div>
          <label for="revOAC">Desired OAC (mm)</label>
          <input id="revOAC" type="number" min="40" max="220" value="126">
        </div>
        <div>
          <label for="revMode">Solve Strategy</label>
          <select id="revMode">
            <option value="ratio" selected>Keep aspect ratio (ICD/IID = r)</option>
            <option value="fixIID">Lock IID, solve ICD</option>
            <option value="fixICD">Lock ICD, solve IID</option>
          </select>
          <div id="revRatioPane" class="rows" style="margin-top:8px">
            <label for="revRatio">Aspect ratio r = ICD/IID <span id="revRatioVal" class="badge">1.20</span></label>
            <input id="revRatio" type="range" min="0.60" max="1.60" step="0.01" value="1.20">
          </div>
          <div id="revFixIID" class="rows" style="display:none;margin-top:8px">
            <label for="revFixIIDval">Set IID (mm)</label>
            <input id="revFixIIDval" type="number" value="35" min="10" max="70">
          </div>
          <div id="revFixICD" class="rows" style="display:none;margin-top:8px">
            <label for="revFixICDval">Set ICD (mm)</label>
            <input id="revFixICDval" type="number" value="45" min="15" max="90">
          </div>
        </div>
      </div>
    </div>
    <div class="card grid">
      <div class="rows">
        <div><span class="muted">IID</span><div id="revOutIID" class="out">—</div></div>
        <div><span class="muted">ICD</span><div id="revOutICD" class="out">—</div></div>
        <div><span class="muted">Check OAC</span><div id="revCheck" class="out">—</div></div>
      </div>
      <div>
        <h3>IID Band (select cohort)</h3>
        <select id="cohortA">
          <option value="38,5">Children 6–7 y (mean 38, SD 5)</option>
          <option value="40.7,4.8">Children 8–9 y</option>
          <option value="43.5,5.3">Children 10–11 y</option>
          <option value="45.5,5.6">Children 12–13 y</option>
          <option value="47.8,5.1">Children 14–15 y</option>
          <option value="53.06,6.27">Adult – Nigeria (Yoruba)</option>
          <option value="52.77,8.06">Adult – Nigeria (Hausa)</option>
          <option value="47.59,8.61">Adult – Nigeria (Igbo)</option>
          <option value="49.33,7.91" selected>Adult – Nigeria (Overall 3 groups)</option>
          <option value="46.69,7.29">Adult – Nigeria (2 regions combined)</option>
        </select>
        <table>
          <thead><tr><th>Band</th><th>Threshold</th><th>Status</th></tr></thead>
          <tbody id="revBand"></tbody>
        </table>
      </div>
    </div>
  </section>

  <section id="panel-macro" class="panel">
    <div class="card">
      <div class="grid">
        <div class="rows">
          <label for="caseRef">Case reference / patient initials</label>
          <input id="caseRef" type="text" placeholder="e.g., Mercy-25-014 / R.E.">
          <label for="curIID">Current IID (mm)</label>
          <input id="curIID" type="number" value="50" min="10" max="80">
          <label for="curICD">Current ICD (mm)</label>
          <input id="curICD" type="number" value="60" min="10" max="110">
        </div>
        <div class="rows">
          <label for="macGoal">Goal type</label>
          <select id="macGoal">
            <option value="targetOAC" selected>Hit a target OAC</option>
            <option value="aestheticICD">Set ICD from facial landmarks</option>
          </select>
          <div id="macOACP" class="rows">
            <label for="macOAC">Target OAC (mm)</label>
            <input id="macOAC" type="number" value="155" min="80" max="220">
            <label for="macLock">Lock parameter</label>
            <select id="macLock">
              <option value="lockIID" selected>Keep IID (solve ICD)</option>
              <option value="lockICD">Keep ICD (solve IID)</option>
              <option value="ratio">Keep aspect ratio r</option>
            </select>
            <div id="macKeepIID" class="rows">
              <label for="macIID">IID (keep, mm)</label>
              <input id="macIID" type="number" value="50" min="15" max="80">
            </div>
            <div id="macKeepICD" class="rows" style="display:none">
              <label for="macICD">ICD (keep, mm)</label>
              <input id="macICD" type="number" value="60" min="15" max="110">
            </div>
            <div id="macRatioPane" class="rows" style="display:none">
              <label for="macR">Aspect ratio r = ICD/IID <span id="macRval" class="badge">1.20</span></label>
              <input id="macR" type="range" min="0.60" max="1.60" step="0.01" value="1.20">
            </div>
          </div>
          <div id="macAesthP" class="rows" style="display:none">
            <label for="macIPD">Interpupillary distance (IPD, mm)</label>
            <input id="macIPD" type="number" value="60" min="40" max="80">
            <label for="macICDalpha">ICD guideline factor (α)</label>
            <input id="macICDalpha" type="number" value="1.00" step="0.05" min="0.8" max="1.2">
            <div class="muted">Rule-of-thumb: ICD ≈ α × IPD (α≈1.0; adjust by facial analysis).</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card grid">
      <div class="rows">
        <h3>Plan Output</h3>
        <div><span class="muted">IID (final)</span><div id="macOutIID" class="out">—</div></div>
        <div><span class="muted">ICD (final)</span><div id="macOutICD" class="out">—</div></div>
        <div><span class="muted">OAC (check)</span><div id="macOutOAC" class="out">—</div></div>
        <div><span class="muted">Composite label</span><div id="macLabel" class="out">—</div></div>
      </div>
      <div class="rows">
        <h3>Safety Rails</h3>
        <table>
          <thead><tr><th>Check</th><th>Threshold</th><th>Status</th></tr></thead>
          <tbody id="macSafety"></tbody>
        </table>
        <div class="muted">Use clinical judgement. Consider orbicularis competence, speech, drooling risk, esthetics.</div>
      </div>
    </div>

    <div class="card">
      <div class="grid">
        <div class="rows">
          <h3>Staging Helper</h3>
          <label for="stages">Stages</label>
          <select id="stages">
            <option value="1" selected>Single-stage</option>
            <option value="2">Two-stage</option>
          </select>
          <div id="stageSplitPane" class="rows" style="display:none">
            <label for="stageSplit">Stage 1 proportion (%)</label>
            <input id="stageSplit" type="number" value="60" min="10" max="90">
            <div class="muted">Stage 1 applies this % of the total change; Stage 2 completes the remainder.</div>
          </div>
        </div>
        <div class="rows">
          <table>
            <thead><tr><th>Stage</th><th>IID</th><th>ICD</th><th>OAC</th><th>IID band</th><th>ICD severity</th></tr></thead>
            <tbody id="stageRows"></tbody>
          </table>
          <div class="no-print"><button id="printBtn">Print / Save PDF</button></div>
        </div>
      </div>
    </div>
  </section>

  <section id="panel-thresholds" class="panel">
    <div class="card">
      <h3>Clinical bands (IID)</h3>
      <div class="grid">
        <div class="rows">
          <label for="thrCohort">Cohort</label>
          <select id="thrCohort">
            <option value="38,5">Children 6–7 y</option>
            <option value="40.7,4.8">Children 8–9 y</option>
            <option value="43.5,5.3">Children 10–11 y</option>
            <option value="45.5,5.6">Children 12–13 y</option>
            <option value="47.8,5.1">Children 14–15 y</option>
            <option value="53.06,6.27">Adult – Nigeria (Yoruba)</option>
            <option value="52.77,8.06">Adult – Nigeria (Hausa)</option>
            <option value="47.59,8.61">Adult – Nigeria (Igbo)</option>
            <option value="49.33,7.91" selected>Adult – Nigeria (Overall 3 groups)</option>
            <option value="46.69,7.29">Adult – Nigeria (2 regions combined)</option>
          </select>
        </div>
        <div class="rows">
          <div><span class="muted">Mean IID</span><div id="thrMean" class="out">—</div></div>
          <div><span class="muted">Likely low (≈ mean − 2SD)</span><div id="thrLow" class="out">—</div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <h3>Miller & O’Neill – Severity by ICD</h3>
      <table><thead><tr><th>Band</th><th>ICD threshold</th></tr></thead>
        <tbody>
          <tr><td>Mild</td><td>&gt; 30 mm</td></tr>
          <tr><td>Moderate</td><td>15–30 mm</td></tr>
          <tr><td>Severe</td><td>&lt; 15 mm</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <section id="panel-about" class="panel">
    <div class="card">
      <h3 style="margin-top:0">About</h3>
      <ul>
        <li><b>Quick OAC</b>: π/2 × (IID + ICD)</li>
        <li><b>Precise OAC</b> (Ramanujan I): π[3(a+b) − √((3a+b)(a+3b))], with a=IID/2, b=ICD/2</li>
        <li>Severity by ICD (Miller & O’Neill) and cohort “likely low” = mean − 2SD.</li>
      </ul>
      <div class="note">PDF printing available in the Macrostomia Planner panel.</div>
      <p class="muted">© Mercy Clinics — Dr. Richard E. Nnabuko. <span class="tagline">In His Hands</span></p>
    </div>
  </section>

  <footer>© Mercy Clinics — Dr. Richard E. Nnabuko. <span class="tagline">In His Hands</span></footer>
</div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => navigator.serviceWorker.register('sw.js?ver=5'));
}
let deferredPrompt; const installBtn = document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; installBtn.style.display='inline-block'; });
installBtn?.addEventListener('click', async()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; });

const panels = ['calc','reverse','macro','thresholds','about'];
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const p = btn.getAttribute('data-panel');
    document.querySelectorAll('.tab').forEach(b=>b.setAttribute('aria-selected', String(b===btn)));
    panels.forEach(id=>{
      const el = document.getElementById('panel-'+id);
      if(!el) return;
      el.classList.toggle('active', id===p);
    });
  });
});
function qOAC(iid,icd){ return Math.PI/2*(iid+icd); }
function pOAC(iid,icd){ const a=iid/2, b=icd/2; return Math.PI*(3*(a+b)-Math.sqrt((3*a+b)*(a+3*b))); }
function bandIID(iid, mean, sd){ const low=mean-2*sd; return { low, band: iid<low?'LOW':(iid<mean?'BORDERLINE':'WITHIN EXPECTED') }; }
function sevICD(icd){ return icd<15?'Severe':(icd<=30?'Moderate':'Mild'); }

function calcUpdate(){
  const IID=parseFloat(document.getElementById('calcIID').value||'0'), ICD=parseFloat(document.getElementById('calcICD').value||'0');
  const oq=qOAC(IID,ICD), op=pOAC(IID,ICD);
  document.getElementById('calcOACq').textContent=oq.toFixed(1)+' mm';
  document.getElementById('calcOACp').textContent=op.toFixed(1)+' mm';
  document.getElementById('calcDelta').textContent=(oq-op).toFixed(1)+' mm';
}
['calcIID','calcICD'].forEach(id=>document.getElementById(id).addEventListener('input',calcUpdate)); calcUpdate();

function revCompute(){
  const target=parseFloat(document.getElementById('revOAC').value||'0'); const sum=2/Math.PI*target; let IID, ICD;
  const mode = document.getElementById('revMode').value;
  if(mode==='ratio'){ const r=parseFloat(document.getElementById('revRatio').value||'1.2'); IID=sum/(1+r); ICD=r*IID; }
  else if(mode==='fixIID'){ IID=parseFloat(document.getElementById('revFixIIDval').value||'35'); ICD=sum-IID; }
  else { ICD=parseFloat(document.getElementById('revFixICDval').value||'45'); IID=sum-ICD; }
  document.getElementById('revOutIID').textContent=IID.toFixed(1)+' mm';
  document.getElementById('revOutICD').textContent=ICD.toFixed(1)+' mm';
  document.getElementById('revCheck').textContent=qOAC(IID,ICD).toFixed(1)+' mm';
  const [m,sd]=document.getElementById('cohortA').value.split(',').map(parseFloat);
  const {low, band}=bandIID(IID,m,sd);
  document.getElementById('revBand').innerHTML = `
    <tr><td>Likely Low</td><td>${low.toFixed(1)} mm</td><td><span class="badge ${band==='LOW'?'low':(band==='BORDERLINE'?'borderline':'ok')}">${band}</span></td></tr>
    <tr><td>Mean</td><td>${m.toFixed(1)} mm</td><td>—</td></tr>`;
}
function revModeUI(){
  const mode=document.getElementById('revMode').value;
  document.getElementById('revRatioPane').style.display = mode==='ratio'?'block':'none';
  document.getElementById('revFixIID').style.display = mode==='fixIID'?'block':'none';
  document.getElementById('revFixICD').style.display = mode==='fixICD'?'block':'none';
  revCompute();
}
['revOAC','revMode','revRatio','revFixIIDval','revFixICDval','cohortA'].forEach(id=>document.getElementById(id).addEventListener('input',revCompute));
document.getElementById('revMode').addEventListener('change',revModeUI);
document.getElementById('revRatio').addEventListener('input',()=>document.getElementById('revRatioVal').textContent=parseFloat(document.getElementById('revRatio').value).toFixed(2));
revModeUI();

function macUI(){
  const goal=document.getElementById('macGoal').value;
  document.getElementById('macOACP').style.display = goal==='targetOAC'?'block':'none';
  document.getElementById('macAesthP').style.display = goal==='aestheticICD'?'block':'none';
  const lock=document.getElementById('macLock').value;
  document.getElementById('macKeepIID').style.display = lock==='lockIID'?'block':'none';
  document.getElementById('macKeepICD').style.display = lock==='lockICD'?'block':'none';
  document.getElementById('macRatioPane').style.display = lock==='ratio'?'block':'none';
  document.getElementById('stageSplitPane').style.display = document.getElementById('stages').value==='2'?'block':'none';
  macCompute();
}
function macCompute(){
  const curIID=parseFloat(document.getElementById('curIID').value||'0'), curICD=parseFloat(document.getElementById('curICD').value||'0');
  let IID, ICD, targetOAC;
  if(document.getElementById('macGoal').value==='targetOAC'){
    targetOAC = parseFloat(document.getElementById('macOAC').value||'0');
    const sum = 2/Math.PI*targetOAC;
    const lock = document.getElementById('macLock').value;
    if(lock==='lockIID'){ IID=parseFloat(document.getElementById('macIID').value||'50'); ICD=sum-IID; }
    else if(lock==='lockICD'){ ICD=parseFloat(document.getElementById('macICD').value||'60'); IID=sum-ICD; }
    else { const r=parseFloat(document.getElementById('macR').value||'1.2'); IID=sum/(1+r); ICD=r*IID; }
  } else {
    const IPD=parseFloat(document.getElementById('macIPD').value||'60'), alpha=parseFloat(document.getElementById('macICDalpha').value||'1.0');
    ICD = alpha*IPD; const r=parseFloat(document.getElementById('macR').value||'1.2'); IID = ICD/r; targetOAC = qOAC(IID,ICD);
  }
  document.getElementById('macOutIID').textContent=IID.toFixed(1)+' mm';
  document.getElementById('macOutICD').textContent=ICD.toFixed(1)+' mm';
  document.getElementById('macOutOAC').textContent=targetOAC.toFixed(1)+' mm';
  const sev = sevICD(ICD);
  const [m,sd]=document.getElementById('macCohort').value.split(',').map(parseFloat);
  const {low, band} = bandIID(IID,m,sd);
  const chan = document.getElementById('macChan').value;
  document.getElementById('macLabel').textContent = `${sev} (ICD ${ICD.toFixed(1)} mm), Type ${chan} • IID band: ${band}`;
  document.getElementById('macSafety').innerHTML = `
    <tr><td>ICD severity</td><td>Mild &gt;30 | Moderate 15–30 | Severe &lt;15</td>
        <td><span class="badge ${sev==='Severe'?'low':(sev==='Moderate'?'borderline':'ok')}">${sev}</span></td></tr>
    <tr><td>IID cohort low</td><td>&lt; ${(m-2*sd).toFixed(1)} mm</td>
        <td><span class="badge ${band==='LOW'?'low':(band==='BORDERLINE'?'borderline':'ok')}">${band}</span></td></tr>`;
  const stages = parseInt(document.getElementById('stages').value||'1',10);
  const split = Math.min(90, Math.max(10, parseFloat(document.getElementById('stageSplit').value||'60'))) / 100.0;
  const dIID = IID - curIID; const dICD = ICD - curICD;
  const IID1 = stages===1 ? IID : curIID + dIID*split;
  const ICD1 = stages===1 ? ICD : curICD + dICD*split;
  const OAC1 = qOAC(IID1,ICD1); const sev1 = sevICD(ICD1); const {band:band1} = bandIID(IID1,m,sd);
  const IID2 = IID; const ICD2 = ICD; const OAC2 = qOAC(IID2,ICD2); const sev2 = sevICD(ICD2); const {band:band2} = bandIID(IID2,m,sd);
  document.getElementById('stageRows').innerHTML = stages===1
    ? `<tr><td>Final</td><td>${IID2.toFixed(1)}</td><td>${ICD2.toFixed(1)}</td><td>${OAC2.toFixed(1)}</td>
         <td><span class="badge ${band2==='LOW'?'low':(band2==='BORDERLINE'?'borderline':'ok')}">${band2}</span></td>
         <td><span class="badge ${sev2==='Severe'?'low':(sev2==='Moderate'?'borderline':'ok')}">${sev2}</span></td></tr>`
    : `<tr><td>Stage 1</td><td>${IID1.toFixed(1)}</td><td>${ICD1.toFixed(1)}</td><td>${OAC1.toFixed(1)}</td>
         <td><span class="badge ${band1==='LOW'?'low':(band1==='BORDERLINE'?'borderline':'ok')}">${band1}</span></td>
         <td><span class="badge ${sev1==='Severe'?'low':(sev1==='Moderate'?'borderline':'ok')}">${sev1}</span></td></tr>
       <tr><td>Stage 2</td><td>${IID2.toFixed(1)}</td><td>${ICD2.toFixed(1)}</td><td>${OAC2.toFixed(1)}</td>
         <td><span class="badge ${band2==='LOW'?'low':(band2==='BORDERLINE'?'borderline':'ok')}">${band2}</span></td>
         <td><span class="badge ${sev2==='Severe'?'low':(sev2==='Moderate'?'borderline':'ok')}">${sev2}</span></td></tr>`;
}
document.getElementById('macGoal').addEventListener('input',macUI);
document.getElementById('macLock').addEventListener('input',macUI);
['macOAC','macIID','macICD','macR','macIPD','macICDalpha','curIID','curICD','stages','stageSplit','caseRef']
  .forEach(id=>document.getElementById(id)?.addEventListener('input',macCompute));
document.getElementById('macR')?.addEventListener('input',()=>{document.getElementById('macRval').textContent=parseFloat(document.getElementById('macR').value).toFixed(2);});
document.getElementById('stages').addEventListener('change',macUI);
document.getElementById('printBtn').addEventListener('click',()=>window.print());

const macroBox = document.querySelector('#panel-macro .card .grid');
if (macroBox) {
  const col = macroBox.children[1];
  const extra = document.createElement('div'); extra.className='rows';
  extra.innerHTML = `
    <label for="macCohort">Cohort (IID band)</label>
    <select id="macCohort">
      <option value="53.06,6.27">Adult – Nigeria (Yoruba)</option>
      <option value="52.77,8.06">Adult – Nigeria (Hausa)</option>
      <option value="47.59,8.61">Adult – Nigeria (Igbo)</option>
      <option value="49.33,7.91" selected>Adult – Nigeria (Overall 3 groups)</option>
      <option value="46.69,7.29">Adult – Nigeria (2 regions combined)</option>
    </select>
    <label for="macChan">Chan extent type</label>
    <select id="macChan">
      <option value="I">Type I – Isolated commissural</option>
      <option value="II">Type II – Diffuse perioral</option>
      <option value="III" selected>Type III – Circumoral</option>
    </select>`;
  col.appendChild(extra);
  extra.querySelectorAll('select').forEach(el=>el.addEventListener('input', macCompute));
}
macUI();

function thrUpdate(){
  const [m,sd]=document.getElementById('thrCohort').value.split(',').map(parseFloat);
  document.getElementById('thrMean').textContent=m.toFixed(1)+' mm';
  document.getElementById('thrLow').textContent=(m-2*sd).toFixed(1)+' mm';
}
document.getElementById('thrCohort').addEventListener('input',thrUpdate); thrUpdate();
</script>
</body>
</html>
